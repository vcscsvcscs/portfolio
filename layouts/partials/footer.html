{{/*  variables for enabling/disabling parts of the footer  */}}
{{ $footerEnabled      := site.Params.footer.enable             | default true }}
{{ $navigationEnabled  := site.Params.footer.navigation.enable  | default true }}
{{ $customMenusEnabled := site.Params.footer.navigation.customMenus | default true }}
{{ $contactMeEnabled   := site.Params.footer.contactMe.enable   | default true }}
{{ $newsletterEnabled  := site.Params.footer.newsletter.enable  | default true }}
{{ $credentialsEnabled := site.Params.footer.credentials.enable | default true }}
{{ $disclaimerEnabled  := site.Params.footer.disclaimer.enable  | default false }}

{{/*  Keep backward compatibility for the newsletter function */}}
{{ if site.Params.newsletter }}
  {{ if site.Params.newsletter.enable }}
    {{ $newsletterEnabled = true }}
  {{ else }}
      {{ $newsletterEnabled = false }}
  {{ end }}
{{ end }}

{{ if $footerEnabled }}
  {{ $author:= site.Data.author }}
  {{ if (index site.Data site.Language.Lang).author }}
    {{ $author = (index site.Data site.Language.Lang).author }}
  {{ end }}

  {{ $sectionsRaw:= site.Data.sections }}
  {{ if (index site.Data site.Language.Lang).sections }}
    {{ $sectionsRaw = (index site.Data site.Language.Lang).sections }}
  {{ end }}
  {{ $sections := $sectionsRaw }}
  {{ if and (not (reflect.IsSlice $sectionsRaw)) (isset $sectionsRaw "sections") }}
    {{ $sections = index $sectionsRaw "sections" }}
  {{ end }}

  {{ $customMenus := site.Params.customMenus }}
  {{ if (index site.Data site.Language.Lang).site.customMenus }}
    {{ $customMenus = (index site.Data site.Language.Lang).site.customMenus }}
  {{ end }}

  {{ $copyrightNotice := now.Format "2006" | printf "Â© %s Copyright."}}
  {{ if (index site.Data site.Language.Lang).site }}
    {{ $siteConfig := (index site.Data site.Language.Lang).site }}
    {{ if $siteConfig.copyright }}
      {{ $copyrightNotice = $siteConfig.copyright }}
    {{ end }}
  {{ end }}


  {{ $disclaimer := "" }}
  {{ $siteConfig := (index site.Data site.Language.Lang).site }}
  {{ if $siteConfig.disclaimer }}
    {{ $disclaimer = $siteConfig.disclaimer }}
  {{ end }}

  {{/*  footer logos  */}}
  {{ $themeLogo:= "/images/theme-logo.png" }}
  {{ if site.Params.footer.theme }}
    {{ $themeLogo = site.Params.footer.theme }}
  {{ end }}
  {{ $themeLogo = resources.Get $themeLogo }}
  {{ if $themeLogo }}
    {{ $themeLogo = $themeLogo.RelPermalink }}
  {{ end }}

  {{ $hugoLogo:= "/images/hugo-logo.svg" }}
  {{ if site.Params.footer.hugo }}
    {{ $hugoLogo = site.Params.footer.hugo }}
  {{ end }}
  {{ $hugoLogo = resources.Get $hugoLogo }}
  {{ if $hugoLogo }}
    {{ $hugoLogo = $hugoLogo.RelPermalink }}
  {{ end }}

  <footer class="container-fluid text-center align-content-center footer pb-2">
    <div class="container pt-5">
      <div class="row text-left">
        {{ if $navigationEnabled }}
        <div class="col-md-4 col-sm-12">
          <h5>{{ i18n "navigation" }}</h5>
          {{ if $sections }}
          <ul>
            {{- range $sections -}}
                {{ if and (.section.enable) (.section.showOnNavbar)}}
                  {{ $sectionID := replace (lower .section.name) " " "-"  }}
                  {{ if .section.id }}
                    {{ $sectionID = .section.id }}
                  {{ end }}
                  <li class="nav-item">
                    <a class="smooth-scroll" href="{{ "" | absLangURL }}#{{ $sectionID }}">{{ .section.name }}</a>
                  </li>
                {{ end }}
            {{- end -}}
            {{ if $customMenusEnabled }}
              {{ range $customMenus }}
                {{ if .showOnFooter }}
                    <li class="nav-item">
                      <a class="smooth-scroll" href="{{ .url }}">{{ .name }}</a>
                    </li>
                {{ end }}
              {{ end }}
            {{ end }}
          </ul>
          {{ end }}
        </div>
        {{ end }}
        <!-------------- Contact Me --------------->
        {{ if $contactMeEnabled }}
        <div class="col-md-4 col-sm-12">
          <h5>{{ i18n "contact_me" }}</h5>
          <ul>
            {{ range $key, $value := $author.contactInfo }}
              {{ if reflect.IsMap $value }}
                <li>
                  {{ if isset $value "url" }}
                  <a href={{ $value.url }} target="_blank" rel="noopener">
                    <span><i class={{ printf "fab fa-%s" $value.icon }}></i></span> <span>{{ $value.text }}</span>
                  </a>
                  {{ else if isset $value "icon" }}
                    <span><i class={{ printf "fab fa-%s" $value.icon }}></i></span> <span>{{ $value.text }}</span>
                  {{ else }}
                    <a href={{ $value.url }} target="_blank" rel="noopener">
                      <span>{{ title $key }}: </span> <span>{{ $value.text }}</span>
                    </a>
                  {{ end }}
                </li>
              {{ else }}
                <li><span>{{ title $key }}: </span> <span>{{ $value }}</span></li>
              {{ end }}
            {{ end }}
          </ul>
        </div>
        {{ end }}
        <!-------------- Newsletter --------------->
        {{ if $newsletterEnabled }}
          {{ $provider := site.Params.footer.newsletter.provider }}
          <div class="col-md-4 col-sm-12">
            <p>{{ i18n "newsletter_text" }}</p>
            {{ if eq $provider "mailchimp" }}
              <form action="{{ site.Params.footer.newsletter.mailchimpURL }}" method="post" name="mc-embedded-subscribe-form" target="_blank" novalidate>
                <div class="input-group">
                  <input type="email" value="" name="EMAIL" id="mce-EMAIL" placeholder="{{ i18n "newsletter_input_placeholder" }}" required>
                  <div class="input-group-append">
                    <button class="btn btn-info" type="submit" name="subscribe" id="mc-embedded-subscribe">{{ i18n "submit" }}</button>
                  </div>
                </div>
              </form>
            {{ else if eq $provider "buttondown" }}
              <form
                action="https://buttondown.email/api/emails/embed-subscribe/{{ site.Params.footer.newsletter.buttondownUsername }}"
                method="post"
                target="popupwindow"
                onsubmit="window.open('https://buttondown.email/{{ site.Params.footer.newsletter.buttondownUsername }}', 'popupwindow')"
                class="embeddable-buttondown-form"
              >
              <div class="input-group">
                <input type='email' class="form-control" name='email' id='bd-email' placeholder="{{ i18n "newsletter_input_placeholder" }}"/>
                <div class="input-group-append">
                  <input type="hidden" value="1" name="embed"/>
                  <input class="btn btn-info" type="submit" value="{{ i18n "submit" }}" />
                </div>
              </div>
              <small id="emailHelp" class="form-text text-muted">{{ i18n "newsletter_warning" }}</small>
              </form>
            {{ else if eq $provider "blogtrottr" }}
              <form action="https://blogtrottr.com/" method="post" target="popupwindow" onsubmit="window.open('https://blogtrottr.com/{{ site.Params.footer.newsletter.blogtrottrEmail }}','popupwindow','scrollbars=yes,width=550,height=520');return true">
              <div class="input-group">
              <input type='email' class="form-control" name='btr_email' placeholder="{{ i18n "newsletter_input_placeholder" }}"/><br />
              <input type='hidden' name='btr_url' value='{{ "" | absLangURL }}/index.xml' />
              <input type='hidden' name='schedule_type' value='1' />
              <small id="emailHelp" class="form-text text-muted">{{ i18n "newsletter_warning" }}</small>
              <button type="submit" class="btn btn-info"> {{ i18n "submit" }} </button>
              </div>
              </form>
            {{ end }}
          </div>
        {{ end }}
      </div>
    </div>
    {{ if and $disclaimerEnabled $disclaimer}}
    <hr />
    <div class="container">
      <p id="disclaimer"><strong>{{ i18n "disclaimer_text" }}:</strong> {{ $disclaimer | markdownify }}</p>
    </div>
    {{ end }}
    {{ if $credentialsEnabled }}
    <hr />
    <div class="container">
      <div class="row text-start">
        <div class="col-md-4">
          <a id="theme" href="https://github.com/hugo-toha/toha" target="_blank" rel="noopener">
            <img src="{{ $themeLogo }}" alt="Toha Theme Logo">
            Toha
          </a>
        </div>
        <div class="col-md-4 text-center">{{ $copyrightNotice | markdownify }}</div>
        <div class="col-md-4 text-end">
          <a id="hugo" href="https://gohugo.io/" target="_blank" rel="noopener">{{ i18n "hugoAttributionText" }}
          <img
            src="{{ $hugoLogo }}"
            alt="Hugo Logo"
            height="18"
          />
          </a>
        </div>
      </div>
    </div>
    {{ end }}
  </footer>
{{end}}
